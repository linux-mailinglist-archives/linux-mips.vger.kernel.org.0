Return-Path: <linux-mips-owner@vger.kernel.org>
X-Original-To: lists+linux-mips@lfdr.de
Delivered-To: lists+linux-mips@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 4D687435DD1
	for <lists+linux-mips@lfdr.de>; Thu, 21 Oct 2021 11:23:06 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S231326AbhJUJZU (ORCPT <rfc822;lists+linux-mips@lfdr.de>);
        Thu, 21 Oct 2021 05:25:20 -0400
Received: from mail.kernel.org ([198.145.29.99]:39314 "EHLO mail.kernel.org"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S231308AbhJUJZU (ORCPT <rfc822;linux-mips@vger.kernel.org>);
        Thu, 21 Oct 2021 05:25:20 -0400
Received: from disco-boy.misterjones.org (disco-boy.misterjones.org [51.254.78.96])
        (using TLSv1.2 with cipher ECDHE-RSA-AES256-GCM-SHA384 (256/256 bits))
        (No client certificate requested)
        by mail.kernel.org (Postfix) with ESMTPSA id 6EC2460E96;
        Thu, 21 Oct 2021 09:23:04 +0000 (UTC)
Received: from sofa.misterjones.org ([185.219.108.64] helo=why.misterjones.org)
        by disco-boy.misterjones.org with esmtpsa  (TLS1.3) tls TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        (Exim 4.94.2)
        (envelope-from <maz@kernel.org>)
        id 1mdUHu-000f8R-Dd; Thu, 21 Oct 2021 10:23:02 +0100
Date:   Thu, 21 Oct 2021 10:23:02 +0100
Message-ID: <87sfwubukp.wl-maz@kernel.org>
From:   Marc Zyngier <maz@kernel.org>
To:     zhaoxiao <long870912@gmail.com>
Cc:     chenhuacai@kernel.org, jiaxun.yang@flygoat.com, tglx@linutronix.de,
        linux-mips@vger.kernel.org, linux-kernel@vger.kernel.org,
        zhaoxiao <zhaoxiao@uniontech.com>
Subject: Re: [PATCH] irqchip/loongson-htvec:- Handle return value of ioremap.
In-Reply-To: <20211015072523.30615-1-long870912@gmail.com>
References: <20211015072523.30615-1-long870912@gmail.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI-EPG/1.14.7 (Harue)
 FLIM-LB/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL-LB/10.8 EasyPG/1.0.0 Emacs/27.1
 (x86_64-pc-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI-EPG 1.14.7 - "Harue")
Content-Type: text/plain; charset=US-ASCII
X-SA-Exim-Connect-IP: 185.219.108.64
X-SA-Exim-Rcpt-To: long870912@gmail.com, chenhuacai@kernel.org, jiaxun.yang@flygoat.com, tglx@linutronix.de, linux-mips@vger.kernel.org, linux-kernel@vger.kernel.org, zhaoxiao@uniontech.com
X-SA-Exim-Mail-From: maz@kernel.org
X-SA-Exim-Scanned: No (on disco-boy.misterjones.org); SAEximRunCond expanded to false
Precedence: bulk
List-ID: <linux-mips.vger.kernel.org>
X-Mailing-List: linux-mips@vger.kernel.org

On Fri, 15 Oct 2021 08:25:23 +0100,
zhaoxiao <long870912@gmail.com> wrote:
> 
> From: zhaoxiao <zhaoxiao@uniontech.com>
> 
> Here, If ioremap will fail. It will return NULL.Kernel can run into
> a NULL-pointer dereference. This error check will avoid NULL pointer
> dereference.
> 
> Signed-off-by: zhaoxiao <zhaoxiao@uniontech.com>
> ---
>  drivers/irqchip/irq-loongson-htvec.c | 3 +++
>  1 file changed, 3 insertions(+)
> 
> diff --git a/drivers/irqchip/irq-loongson-htvec.c b/drivers/irqchip/irq-loongson-htvec.c
> index 1cc0bceb4472..a36c20f44ec4 100644
> --- a/drivers/irqchip/irq-loongson-htvec.c
> +++ b/drivers/irqchip/irq-loongson-htvec.c
> @@ -267,6 +267,8 @@ struct fwnode_handle *htvec_acpi_init(struct fwnode_handle *parent,
>  
>  	priv->num_parents = HTVEC_MAX_PARENT_IRQ;
>  	priv->base = ioremap(acpi_htvec->address, acpi_htvec->size);
> +	if (!priv->base)
> +		goto free_priv;
>  
>  	/* Interrupt may come from any of the 8 interrupt lines */
>  	for (i = 0; i < priv->num_parents; i++)
> @@ -307,6 +309,7 @@ struct fwnode_handle *htvec_acpi_init(struct fwnode_handle *parent,
>  iounmap_base:
>  	iounmap(priv->base);
>  	priv->domain_handle = NULL;
> +free_priv:
>  	kfree(priv);
>  
>  	return NULL;

I have no idea what code base this patch is against, but certainly not
any upstream kernel. There is no trace of any ACPI support in this
driver.

Please only send patches that make sense for upstream.

	M.

-- 
Without deviation from the norm, progress is not possible.
